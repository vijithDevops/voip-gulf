{% load static %}
<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
      <title>OliveMPay</title>
      <meta name="description" content="" />
      <meta name="keywords" content="sherin shaju ,sherin shaju athickal" />
      <meta name="Sherin Shaju" content="Sherin"/>
      <!-- Favicon -->
      <link rel="shortcut icon" href="favicon.ico">
      <link rel="icon" href="favicon.ico" type="image/x-icon">
      <!-- Data table CSS -->
      <link href="{% static "vendors/bower_components/datatables/media/css/jquery.dataTables.min.css" %}" rel="stylesheet" type="text/css"/>
      <!-- Custom CSS -->
      <link href="{% static "dist/css/style.css" %}" rel="stylesheet" type="text/css">
      <link rel="stylesheet" href="{% static "select css/bootstrap-select.css" %}">
      <!-- jQuery -->
      <script src="{% static "vendors/bower_components/jquery/dist/jquery.min.js" %}"></script>
      <style>
         .navbar.navbar-inverse {
         background: #000000d9;
         }
         .navbar {
         border-radius: 0px;
         }
         .page-wrapper {
         margin-left: 19px;
         padding: 30px 20px;
         position: relative;
         -webkit-transition: all 0.4s ease;
         -moz-transition: all 0.4s ease;
         transition: all 0.4s ease;
         left: 0;
         }
         @media only screen and (max-width: 767px) {
         .page-wrapper {
         margin-left: 19px;
         padding: 0px 0px;
         position: relative;
         -webkit-transition: all 0.4s ease;
         -moz-transition: all 0.4s ease;
         transition: all 0.4s ease;
         left: 0;
         }
         }
      </style>
   </head>
   <body>
      <!-- Preloader -->
      <div class="preloader-it">
         <div class="la-anim-1"></div>
      </div>
      <!-- /Preloader -->
      <div class="wrapper theme-6-active pimary-color-yellow">
         <nav class="navbar navbar-inverse">
            <div class="container-fluid">
               <div class="navbar-header">
                  <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                  </button>
                  <a class="navbar-brand" href="#">OliveMPay</a>
               </div>
               <div class="collapse navbar-collapse" id="myNavbar">
                 <ul class="nav navbar-nav">
                   <li><a href="{% url "subresellerRcardDashboard" %}">Home</a></li>
                   <li><a href="{% url "subresellerprofilercard" %}">Edit Profile</a></li>
                    <li class="">
                       <a class="dropdown-toggle" data-toggle="dropdown" href="#" aria-expanded="false">User Management
                       <span class="caret"></span></a>
                       <ul class="dropdown-menu">
                          <li><a href="{% url "subreselleraddUserRcard" %}">Add User</a></li>
                          <li><a href="{% url "subresellerviewUserRcard" %}">View User</a></li>
                       </ul>
                    </li>
                    <li class="">
                       <a class="dropdown-toggle" data-toggle="dropdown" href="#" aria-expanded="false">Balance Management	<span class="caret"></span></a>
                       <ul class="dropdown-menu">
                          <li>
                            <a href="{% url "subresellerbalanceTransferRcard" %}">Balance transfer</a>
                          </li>
                          <li>
                            <a href="{% url "subreselleraddPaymentRcard" %}">Add Payment</a>
                          </li>
                       </ul>
                    </li>
                    <li>
                       <a class="dropdown-toggle" data-toggle="dropdown" href="#">Reports  <span class="caret"></span> </a>
                       <ul class="dropdown-menu">
                          <li>
                             <a href="{% url "subresellerrcardreport" %}">Vcloud Report</a>
                          </li>
                          <li>
                               <a href="{% url "subresellerbTReportRcard" %}">Balance Transfer Report</a>
                          </li>
                          <li>
                             <a href="{% url "subresellerpaymentReportRcard" %}">Payment Report</a>
                          </li>
                       </ul>
                    </li>
                    <li><a href="{% url "subresellerassignRCardBrands" %}">Assign Brand </a></li>
                    <li><a href="{% url "subresellerrcardviewbrands" %}">View  Brand </a></li>
                    <li><a href="{% url "subresellerrcardstore" %}">Store </a></li>
                    <li><a href="{% url "subresellerrcardchangepassword" %}">Change password</a></li>
                  </ul>
                  <ul class="nav navbar-nav navbar-right">
                    <li><a href="#">Balance: {{ user.balance }}</a></li>
                    <li><a href="#">Credit : {{ user.targetAmt }}</a></li>
                    <li>
                        <a class="dropdown-toggle" data-toggle="dropdown" href="#">{{ user.name }}	<span class="caret"></span></a>
                        <ul class="dropdown-menu">
                           <li>
                              <a href="{% url "logout" %}">Logout</a>
                           </li>
                        </ul>
                     </li>
                  </ul>
               </div>
            </div>
         </nav>
         <!-- Main Content -->
         <div class="page-wrapper">
            <div class="container-fluid pt-25">
               <div class="row">
                  <div class="col-sm-12">
                     <div class="panel panel-default card-view">
                        <div class="panel-heading">
                           <div class="pull-left">
                              <h6 class="panel-title txt-dark">Balance Transfer</h6>
                           </div>
                           <div class="clearfix"></div>
                        </div>
                        <div class="panel-wrapper collapse in">
                          {% block content %}
                           <div class="panel-body">
                              <div class="form-wrap">
                                 <form class="form-horizontal" method="POST" action="{% url "subresellersubBalTransRcard" %}">
                                   {% csrf_token %}
                                    <div class="form-group" style="display:none";>
                                       <label class="control-label mb-10 col-sm-3" for="UserType">Select UserType:</label>
                                       <div class="col-sm-8">
                                         <select id="usertype" name="userType" class="form-control">
                                            <option value="Reseller" >Reseller</option>
                                            <option value="User" selected>User</option>
               													</select>
                                       </div>
                                    </div>
                                    <div class="form-group">
                                       <label class="control-label mb-10 col-sm-3" for="users">Select User:</label>
                                       <div class="col-sm-8">
                                          <select id="users" name="users" class="form-control" required>
                                          </select>
                                       </div>
                                    </div>
                                    <div class="form-group">
                                       <label class="control-label mb-10 col-sm-3" for="crbalance">Credit Balance:</label>
                                       <div class="col-sm-8">
                                          <input type="text" id="crbalance" class="form-control" name="crbalance" placeholder="Credit Balance" disabled>
                                       </div>
                                    </div>
                                    <div class="form-group">
                                       <label class="control-label mb-10 col-sm-3" for="amount">Enter amount:</label>
                                       <div class="col-sm-8">
                                          <input type="text" class="form-control" name="amount" placeholder="Enter amount" required="">
                                       </div>
                                    </div>
                                    <div class="form-group mb-0">
                                       <div class="col-sm-offset-3 col-sm-10">
                                          <button type="submit" class="btn  btn-primary btn-rounded">Submit</button>
                                       </div>
                                    </div>
                                 </form>
                                 {% if messages %}
                                 {% for message in messages %}
                                <div {% if message.tags %} class="alert alert-{{ message.tags }}" {% endif %}>
                                  <strong>{{ message.tag }}</strong> {{ message }}
                                </div>
                                 {% endfor %}
                                 {% endif %}
                              </div>
                           </div>
                           {% endblock %}
                        </div>
                     </div>
                  </div>
               </div>
               <div class="row">
                  <div class="col-sm-12">
                     <div class="panel panel-default card-view">
                        <div class="panel-heading">
                           <div class="pull-left">
                              <h6 class="panel-title txt-dark">Recent Transactions</h6>
                           </div>
                           <div class="clearfix"></div>
                        </div>
                        <div class="panel-wrapper collapse in">
                           <div class="panel-body">
                              <div class="table-wrap">
                                 <div class="table-responsive">
                                    <table id="datable_1" class="table table-hover display  pb-30" >
                                       <thead>
                                          <tr>
                                             <th>ID</th>
                                             <th>DATE</th>
                                             <th>SOURCE</th>
                                             <th>DESTINATION</th>
                                             <th>AMOUNT</th>
                                          </tr>
                                       </thead>
                                       <tfoot>
                                          <tr>
                                             <th>ID</th>
                                             <th>DATE</th>
                                             <th>SOURCE</th>
                                             <th>DESTINATION</th>
                                             <th>AMOUNT</th>
                                          </tr>
                                       </tfoot>
                                       <tbody>
                                         {% for bt in bthist %}
                                          <tr>
                                             <td>{{ bt.id }}</td>
                                             <td>{{ bt.date }}</td>
                                             <td>{{ bt.source.name }}</td>
                                             <td>{{ bt.destination.name }}</td>
                                             <td>{{ bt.amount }}</td>
                                          </tr>
                                          {% endfor %}
                                       </tbody>
                                    </table>
                                 </div>
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
               <!-- /Row -->
            </div>
            <!-- Footer -->
            <footer class="footer container-fluid pl-30 pr-30">
               <div class="row">
                  <div class="col-sm-12">
                     <p>Developed and maintained by Nuvac technologies Â© 2018</p>
                  </div>
               </div>
            </footer>
            <!-- /Footer -->
         </div>
         <!-- /Main Content -->
      </div>
      <!-- /#wrapper -->
      <script src="{% static "select css/bootstrap-select.js" %}" defer></script>

      <!-- Bootstrap Core JavaScript -->
      <script src="{% static "vendors/bower_components/bootstrap/dist/js/bootstrap.min.js" %}"></script>
      <!-- Data table JavaScript -->
      <script src="{% static "vendors/bower_components/datatables/media/js/jquery.dataTables.min.js" %}"></script>
      <!-- Slimscroll JavaScript -->
      <script src="{% static "dist/js/jquery.slimscroll.js" %}"></script>
      <!-- Init JavaScript -->
      <script src="{% static "dist/js/init.js" %}"></script>
   </body>
   <script>
      document.addEventListener('DOMContentLoaded', function () {
        var mySelect = $('#first-disabled2');

        $('#special').on('click', function () {
          mySelect.find('option:selected').prop('disabled', true);
          mySelect.selectpicker('refresh');
        });

        $('#special2').on('click', function () {
          mySelect.find('option:disabled').prop('disabled', false);
          mySelect.selectpicker('refresh');
        });

        $('#basic2').selectpicker({
          liveSearch: true,
          maxOptions: 1
        });
      });

      $(document).ready(function() {
        "use strict";
        $('#datable_1').DataTable({'ordering':false});
        getDefaultResellerList();
        var fuser = $('#user option:selected').val();
        getCredit(fuser)
        $("#usertype").change(function () {
          var usertype = $(this).val();
          var select=$("#users").empty();
          $.ajax({
            url: '/ajax/get_user_or_reseller/',
            data: {
              'usertype': usertype
            },
            dataType: 'json',
            success: function (data) {
              console.log(data);
              $.each(data,function(key,value){
                $('#users').append("<option value="+value.pk+">"+value.fields.name+"</option>");
              });
            }
          });
        });
        $("#users").change(function () {
          var users = document.getElementById('users');
          var opt = users.options[users.selectedIndex];
          getCredit(opt.value)
        });
      });
      function getDefaultResellerList()
      {
        $.ajax({
          url: '/ajax/get_user_or_reseller/',
          data: {
            'usertype': "User"
          },
          dataType: 'json',
          success: function (data) {
            console.log(data);
            var first=true;
            $.each(data,function(key,value){
              if(first)
              {
                getCredit(value.pk);
                first=false;
              }
              $('#users').append("<option value="+value.pk+">"+value.fields.name+"</option>");
            });
          }
        });
      }
      function getCredit(user)
      {
        $.ajax({
          url: '/ajax/get_user_or_reseller_credit/',
          data: {
            'users': user
          },
          dataType: 'json',
          success: function (data) {
            $("#crbalance").val(data.targetAmt);
          }
        });
      }
   </script>
</html>
